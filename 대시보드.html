<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025년 강사 성과 분석 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel file parsing -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A tab-based single-page application with three main views: 'Overall Status', 'Instructor Analysis', and 'Program & Content Analysis'. This structure separates high-level KPIs from deep-dive analyses, allowing users to choose their desired level of detail. The flow starts with a summary and enables drilling down into specific areas (instructors, programs) for better usability and focused exploration of the instructor performance data. A file upload feature is included for future data integration. -->
    <!-- Visualization & Content Choices: KPIs -> Inform -> Styled Text Cards -> JS update. Monthly Trend -> Show Change -> Line Chart (Chart.js) -> Update on data change. Rankings/Comparisons -> Compare -> Horizontal Bar Charts (Chart.js) & Sortable HTML Table -> Interactive sorting/selection. Proportions -> Show Parts-of-Whole -> Donut Charts (Chart.js) -> Quick visual breakdown of top contributors. This selection provides a comprehensive yet clear view of the data without overwhelming the user. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfaf6;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 40vh;
            max-height: 400px;
        }
        .nav-btn {
            transition: all 0.3s ease;
        }
        .nav-btn.active {
            background-color: #8d6e63;
            color: #ffffff;
            font-weight: 700;
        }
        .kpi-card {
            background-color: #ffffff;
            border-left: 5px solid #a1887f;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .table-container {
            max-height: 60vh;
            overflow-y: auto;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c5bcae;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1887f;
        }
    </style>
</head>
<body class="text-[#3e2723]">

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-[#5d4037] mb-2">2025년 강사 성과 분석 대시보드</h1>
            <p class="text-lg text-[#6d4c41]">데이터 기반 운영 현황 및 인사이트</p>
        </header>

        <div class="bg-white p-4 rounded-lg shadow-md mb-8 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#8d6e63]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                <p class="text-sm font-medium text-[#6d4c41]">하반기 또는 신규 데이터를 추가하여 대시보드를 업데이트하세요.</p>
            </div>
            <div class="flex items-center gap-2">
                <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls" class="text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#efebe9] file:text-[#6d4c41] hover:file:bg-[#d7ccc8] cursor-pointer"/>
                <button id="updateDataBtn" class="bg-[#a1887f] text-white font-bold py-2 px-4 rounded-full hover:bg-[#8d6e63] transition-colors duration-300">업데이트</button>
            </div>
        </div>

        <nav class="flex justify-center bg-[#efebe9] rounded-lg p-2 mb-8 shadow-sm">
            <button class="nav-btn active flex-1 py-2 px-4 rounded-md text-center" data-target="dashboard">종합 현황</button>
            <button class="nav-btn flex-1 py-2 px-4 rounded-md text-center" data-target="instructors">강사별 분석</button>
            <button class="nav-btn flex-1 py-2 px-4 rounded-md text-center" data-target="programs">프로그램 & 콘텐츠</button>
        </nav>

        <main>
            <section id="dashboard" class="content-section">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-[#8d6e63]">총 강의 시간</h3>
                        <p id="totalHours" class="text-4xl font-bold mt-2">0</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-[#8d6e63]">총 강의 횟수</h3>
                        <p id="totalSessions" class="text-4xl font-bold mt-2">0</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-[#8d6e63]">활동 강사 수</h3>
                        <p id="totalInstructors" class="text-4xl font-bold mt-2">0</p>
                    </div>
                    <div class="kpi-card p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-[#8d6e63]">총 프로그램 수</h3>
                        <p id="totalPrograms" class="text-4xl font-bold mt-2">0</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-xl font-bold mb-4 text-[#5d4037]">월별 강의 시간 추이</h2>
                    <div class="chart-container">
                        <canvas id="monthlyTrendChart"></canvas>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold mb-4 text-[#5d4037]">상위 5개 프로그램 (횟수 기준)</h2>
                        <div class="chart-container h-[45vh] max-h-[450px]">
                            <canvas id="topProgramsChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold mb-4 text-[#5d4037]">상위 5개 콘텐츠 (횟수 기준)</h2>
                        <div class="chart-container h-[45vh] max-h-[450px]">
                            <canvas id="topContentsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="instructors" class="content-section hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold mb-4 text-[#5d4037]">강사 순위</h2>
                        <div class="table-container">
                           <table class="w-full text-sm text-left">
                                <thead class="text-xs text-[#6d4c41] uppercase bg-[#efebe9] sticky top-0">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">강사명</th>
                                        <th scope="col" class="px-6 py-3 text-right">총 시간</th>
                                        <th scope="col" class="px-6 py-3 text-right">총 횟수</th>
                                    </tr>
                                </thead>
                                <tbody id="instructorTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h2 id="instructorDetailName" class="text-xl font-bold mb-4 text-[#5d4037]">강사를 선택하여 상세 정보를 확인하세요.</h2>
                        <div id="instructorDetailContent" class="hidden">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="bg-[#f5f5f5] p-4 rounded-lg">
                                    <h3 class="font-semibold text-gray-600">총 강의 시간</h3>
                                    <p id="instructorDetailHours" class="text-2xl font-bold"></p>
                                </div>
                                <div class="bg-[#f5f5f5] p-4 rounded-lg">
                                    <h3 class="font-semibold text-gray-600">총 강의 횟수</h3>
                                    <p id="instructorDetailSessions" class="text-2xl font-bold"></p>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold mb-2 text-[#6d4c41]">담당 콘텐츠 분포 (시간 기준)</h3>
                            <div class="chart-container h-[30vh] max-h-[250px] mb-6">
                                <canvas id="instructorContentChart"></canvas>
                            </div>
                            <h3 class="text-lg font-bold mb-2 text-[#6d4c41]">참여 프로그램 분포 (횟수 기준)</h3>
                            <div class="chart-container h-[30vh] max-h-[250px]">
                                <canvas id="instructorProgramChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="programs" class="content-section hidden">
                 <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold mb-4 text-[#5d4037]">프로그램별 총 강의 시간</h2>
                        <div class="chart-container h-[60vh] max-h-[600px]">
                            <canvas id="programHoursChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold mb-4 text-[#5d4037]">콘텐츠별 총 강의 시간</h2>
                        <div class="chart-container h-[60vh] max-h-[600px]">
                            <canvas id="contentHoursChart"></canvas>
                        </div>
                    </div>
                 </div>
                 
                 <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                     <h2 class="text-xl font-bold mb-4 text-[#5d4037]">프로그램 순위</h2>
                     <div class="table-container">
                         <table class="w-full text-sm text-left">
                             <thead class="text-xs text-[#6d4c41] uppercase bg-[#efebe9] sticky top-0">
                                 <tr>
                                     <th scope="col" class="px-6 py-3">프로그램명</th>
                                     <th scope="col" class="px-6 py-3 text-right">총 시간</th>
                                     <th scope="col" class="px-6 py-3 text-right">총 횟수</th>
                                 </tr>
                             </thead>
                             <tbody id="programTableBody">
                             </tbody>
                         </table>
                     </div>
                 </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let lectureData = [];
    let charts = {};

    const chartColors = {
        backgroundColor: ['#d7ccc8', '#bcaaa4', '#a1887f', '#8d6e63', '#795548', '#6d4c41', '#5d4037', '#4e342e', '#3e2723'],
        borderColor: '#ffffff'
    };

    function parseCSV(csv) {
        const lines = csv.split('\n');
        const result = [];
        const headers = lines[0].split(',');
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const obj = {};
            const currentline = lines[i].split(',');
            for (let j = 0; j < headers.length; j++) {
                obj[headers[j].trim()] = currentline[j] ? currentline[j].trim() : '';
            }
            result.push(obj);
        }
        return result;
    }

    function processData(data) {
        console.log('processData 시작:', data.length, '행');
        console.log('첫 번째 행 샘플:', data[0]);
        
        const processed = data.map(row => ({
            ...row,
            '강의 시간': parseFloat(row['강의 시간']) || 0,
            '날짜': row['날짜'] ? new Date(row['날짜'].replace(/\.\s/g, '-')) : null
        })).filter(row => {
            const isValid = row['강사명'] && row['날짜'] && !isNaN(row['날짜'].getTime());
            if (!isValid) {
                console.log('필터링된 행:', row);
            }
            return isValid;
        });
        
        console.log('처리 완료:', processed.length, '행');
        console.log('처리된 첫 번째 행:', processed[0]);
        return processed;
    }

    function updateDashboard() {
        console.log('updateDashboard 호출됨, lectureData 길이:', lectureData.length);
        
        if (lectureData.length === 0) {
            console.log('데이터가 없음 - "데이터 없음" 표시');
            // 데이터가 없을 때 "데이터 없음" 표시
            document.getElementById('totalHours').textContent = '데이터 없음';
            document.getElementById('totalSessions').textContent = '데이터 없음';
            document.getElementById('totalInstructors').textContent = '데이터 없음';
            document.getElementById('totalPrograms').textContent = '데이터 없음';
            
            // 차트들도 빈 데이터로 업데이트
            updateMonthlyTrendChart();
            updateTopCharts();
            updateInstructorSection();
            updateProgramSection();
            return;
        }

        console.log('데이터가 있음 - KPI 업데이트 시작');
        const totalHours = lectureData.reduce((sum, row) => sum + row['강의 시간'], 0);
        const totalSessions = lectureData.length;
        const uniqueInstructors = new Set(lectureData.map(row => row['강사명']));
        const uniquePrograms = new Set(lectureData.map(row => row['프로그램명']));

        console.log('계산된 값들:', { totalHours, totalSessions, uniqueInstructors: uniqueInstructors.size, uniquePrograms: uniquePrograms.size });

        document.getElementById('totalHours').textContent = totalHours.toFixed(1);
        document.getElementById('totalSessions').textContent = totalSessions;
        document.getElementById('totalInstructors').textContent = uniqueInstructors.size;
        document.getElementById('totalPrograms').textContent = uniquePrograms.size;

        console.log('KPI 업데이트 완료, 차트 업데이트 시작');
        updateMonthlyTrendChart();
        updateTopCharts();
        updateInstructorSection();
        updateProgramSection();
        console.log('대시보드 업데이트 완료');
    }

    function getAggregatedData(key) {
        const aggregation = lectureData.reduce((acc, row) => {
            const item = row[key];
            if (item) {
                if (!acc[item]) {
                    acc[item] = { sessions: 0, hours: 0 };
                }
                acc[item].sessions += 1;
                acc[item].hours += row['강의 시간'];
            }
            return acc;
        }, {});
        return Object.entries(aggregation).map(([name, data]) => ({ name, ...data }));
    }

    function updateMonthlyTrendChart() {
        if (lectureData.length === 0) {
            // 데이터가 없을 때 빈 차트 표시
            const chartData = {
                labels: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
                datasets: [{
                    label: '월별 총 강의 시간',
                    data: Array(12).fill(0),
                    backgroundColor: '#a1887f',
                    borderColor: '#6d4c41',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.1
                }]
            };
            charts.monthlyTrend.data = chartData;
            charts.monthlyTrend.update();
            return;
        }

        const monthlyData = Array(12).fill(0);
        lectureData.forEach(row => {
            const month = row['날짜'].getMonth();
            monthlyData[month] += row['강의 시간'];
        });

        const chartData = {
            labels: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            datasets: [{
                label: '월별 총 강의 시간',
                data: monthlyData,
                backgroundColor: '#a1887f',
                borderColor: '#6d4c41',
                borderWidth: 2,
                fill: true,
                tension: 0.1
            }]
        };
        charts.monthlyTrend.data = chartData;
        charts.monthlyTrend.update();
    }

    function updateTopCharts() {
        if (lectureData.length === 0) {
            // 데이터가 없을 때 빈 차트 표시
            charts.topPrograms.data.labels = ['데이터 없음'];
            charts.topPrograms.data.datasets[0].data = [0];
            charts.topPrograms.update();

            charts.topContents.data.labels = ['데이터 없음'];
            charts.topContents.data.datasets[0].data = [0];
            charts.topContents.update();
            return;
        }

        const programData = getAggregatedData('프로그램명').sort((a, b) => b.sessions - a.sessions).slice(0, 5);
        const contentData = getAggregatedData('담당 콘텐츠').sort((a, b) => b.sessions - a.sessions).slice(0, 5);

        charts.topPrograms.data.labels = programData.map(d => d.name);
        charts.topPrograms.data.datasets[0].data = programData.map(d => d.sessions);
        charts.topPrograms.update();

        charts.topContents.data.labels = contentData.map(d => d.name);
        charts.topContents.data.datasets[0].data = contentData.map(d => d.sessions);
        charts.topContents.update();
    }
    
    function updateInstructorSection() {
        const tableBody = document.getElementById('instructorTableBody');
        tableBody.innerHTML = '';
        
        if (lectureData.length === 0) {
            // 데이터가 없을 때 "데이터 없음" 메시지 표시
            const row = document.createElement('tr');
            row.className = 'bg-white border-b';
            row.innerHTML = `
                <td colspan="3" class="px-6 py-4 text-center text-gray-500">데이터 없음</td>
            `;
            tableBody.appendChild(row);
            return;
        }

        const instructorData = getAggregatedData('강사명').sort((a, b) => b.hours - a.hours);
        instructorData.forEach(instructor => {
            const row = document.createElement('tr');
            row.className = 'bg-white border-b hover:bg-gray-50 cursor-pointer';
            row.innerHTML = `
                <td class="px-6 py-4 font-medium whitespace-nowrap">${instructor.name}</td>
                <td class="px-6 py-4 text-right">${instructor.hours.toFixed(1)}</td>
                <td class="px-6 py-4 text-right">${instructor.sessions}</td>
            `;
            row.addEventListener('click', () => {
                updateInstructorDetail(instructor.name);
                tableBody.querySelectorAll('tr').forEach(r => r.classList.remove('bg-amber-100'));
                row.classList.add('bg-amber-100');
            });
            tableBody.appendChild(row);
        });
    }

    function updateInstructorDetail(instructorName) {
        document.getElementById('instructorDetailName').textContent = `${instructorName} 강사 상세 분석`;
        document.getElementById('instructorDetailContent').classList.remove('hidden');

        if (lectureData.length === 0) {
            document.getElementById('instructorDetailHours').textContent = '데이터 없음';
            document.getElementById('instructorDetailSessions').textContent = '데이터 없음';
            return;
        }

        const instructorAllData = lectureData.filter(row => row['강사명'] === instructorName);
        const totalHours = instructorAllData.reduce((sum, row) => sum + row['강의 시간'], 0);
        const totalSessions = instructorAllData.length;

        document.getElementById('instructorDetailHours').textContent = `${totalHours.toFixed(1)} 시간`;
        document.getElementById('instructorDetailSessions').textContent = `${totalSessions}회`;

        const contentAggregation = instructorAllData.reduce((acc, row) => {
            const content = row['담당 콘텐츠'];
            if(content) {
                acc[content] = (acc[content] || 0) + row['강의 시간'];
            }
            return acc;
        }, {});
        const sortedContent = Object.entries(contentAggregation).sort((a, b) => b[1] - a[1]);
        
        charts.instructorContent.data.labels = sortedContent.map(d => d[0]);
        charts.instructorContent.data.datasets[0].data = sortedContent.map(d => d[1]);
        charts.instructorContent.update();

        const programAggregation = instructorAllData.reduce((acc, row) => {
            const program = row['프로그램명'];
            if(program) {
                acc[program] = (acc[program] || 0) + 1;
            }
            return acc;
        }, {});
        const sortedPrograms = Object.entries(programAggregation).sort((a, b) => b[1] - a[1]);

        charts.instructorProgram.data.labels = sortedPrograms.map(d => d[0]);
        charts.instructorProgram.data.datasets[0].data = sortedPrograms.map(d => d[1]);
        charts.instructorProgram.update();
    }

    function updateProgramDetail(programName) {
        // 프로그램 상세 정보 표시 (필요시 구현)
        console.log(`프로그램 상세: ${programName}`);
    }
    
    function updateProgramSection() {
        const tableBody = document.getElementById('programTableBody');
        tableBody.innerHTML = '';
        
        if (lectureData.length === 0) {
            // 데이터가 없을 때 "데이터 없음" 메시지 표시
            const row = document.createElement('tr');
            row.className = 'bg-white border-b';
            row.innerHTML = `
                <td colspan="3" class="px-6 py-4 text-center text-gray-500">데이터 없음</td>
            `;
            tableBody.appendChild(row);
            
            // 차트들도 빈 데이터로 업데이트
            updateProgramCharts();
            return;
        }

        const programData = getAggregatedData('프로그램명').sort((a, b) => b.hours - a.hours);
        programData.forEach(program => {
            const row = document.createElement('tr');
            row.className = 'bg-white border-b hover:bg-gray-50 cursor-pointer';
            row.innerHTML = `
                <td class="px-6 py-4 font-medium whitespace-nowrap">${program.name}</td>
                <td class="px-6 py-4 text-right">${program.hours.toFixed(1)}</td>
                <td class="px-6 py-4 text-right">${program.sessions}</td>
            `;
            row.addEventListener('click', () => {
                updateProgramDetail(program.name);
                tableBody.querySelectorAll('tr').forEach(r => r.classList.remove('bg-amber-100'));
                row.classList.add('bg-amber-100');
            });
            tableBody.appendChild(row);
        });
        
        // 차트들 업데이트
        updateProgramCharts();
    }

    function updateProgramCharts() {
        if (lectureData.length === 0) {
            // 데이터가 없을 때 빈 차트 표시
            charts.programHours.data.labels = ['데이터 없음'];
            charts.programHours.data.datasets[0].data = [0];
            charts.programHours.update();
            
            charts.contentHours.data.labels = ['데이터 없음'];
            charts.contentHours.data.datasets[0].data = [0];
            charts.contentHours.update();
            return;
        }

        const programData = getAggregatedData('프로그램명').sort((a, b) => a.hours - b.hours);
        const contentData = getAggregatedData('담당 콘텐츠').sort((a, b) => a.hours - b.hours);

        charts.programHours.data.labels = programData.map(d => d.name);
        charts.programHours.data.datasets[0].data = programData.map(d => d.hours);
        charts.programHours.update();
        
        charts.contentHours.data.labels = contentData.map(d => d.name);
        charts.contentHours.data.datasets[0].data = contentData.map(d => d.hours);
        charts.contentHours.update();
    }

    function initializeCharts() {
        charts.monthlyTrend = new Chart(document.getElementById('monthlyTrendChart'), {
            type: 'line', options: { responsive: true, maintainAspectRatio: false }
        });
        charts.topPrograms = new Chart(document.getElementById('topProgramsChart'), {
            type: 'doughnut', options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } },
            data: { datasets: [{ ...chartColors }] }
        });
        charts.topContents = new Chart(document.getElementById('topContentsChart'), {
            type: 'doughnut', options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } },
            data: { datasets: [{ ...chartColors }] }
        });
        charts.instructorContent = new Chart(document.getElementById('instructorContentChart'), {
            type: 'bar', options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y' },
            data: { datasets: [{ label: '강의 시간', ...chartColors }] }
        });
        charts.instructorProgram = new Chart(document.getElementById('instructorProgramChart'), {
            type: 'bar', options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y' },
            data: { datasets: [{ label: '횟수', ...chartColors }] }
        });
        charts.programHours = new Chart(document.getElementById('programHoursChart'), {
            type: 'bar', options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } },
            data: { datasets: [{ label: '총 강의 시간', ...chartColors }] }
        });
        charts.contentHours = new Chart(document.getElementById('contentHoursChart'), {
            type: 'bar', options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } },
            data: { datasets: [{ label: '총 강의 시간', ...chartColors }] }
        });
    }

    document.getElementById('updateDataBtn').addEventListener('click', () => {
        const fileInput = document.getElementById('csvFileInput');
        const file = fileInput.files[0];
        
        if (!file) {
            alert('먼저 파일을 선택해주세요.');
            return;
        }
        
        console.log('파일 업로드 시작:', file.name, file.type);
        
        const fileName = file.name.toLowerCase();
        if (fileName.endsWith('.csv')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('CSV 파일 읽기 완료');
                const newCsvData = e.target.result;
                console.log('CSV 데이터 샘플:', newCsvData.substring(0, 200));
                const newData = parseCSV(newCsvData);
                console.log('파싱된 데이터:', newData.length, '행');
                const processedNewData = processData(newData);
                console.log('처리된 데이터:', processedNewData.length, '행');
                lectureData = processedNewData;
                alert('CSV 데이터가 성공적으로 추가되었습니다. 대시보드를 업데이트합니다.');
                updateDashboard();
            };
            reader.readAsText(file, 'UTF-8');
        } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('Excel 파일 읽기 완료');
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                console.log('시트 이름:', firstSheetName);
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });
                console.log('Excel에서 추출된 데이터:', jsonData.length, '행');
                console.log('첫 번째 행 샘플:', jsonData[0]);
                
                // jsonData의 키를 CSV와 맞추기 위해 트림
                const normalizedData = jsonData.map(row => {
                    const obj = {};
                    Object.keys(row).forEach(key => {
                        obj[key.trim()] = typeof row[key] === 'string' ? row[key].trim() : row[key];
                    });
                    return obj;
                });
                console.log('정규화된 데이터:', normalizedData.length, '행');
                console.log('정규화된 첫 번째 행:', normalizedData[0]);
                
                const processedNewData = processData(normalizedData);
                console.log('최종 처리된 데이터:', processedNewData.length, '행');
                lectureData = processedNewData;
                alert('엑셀 데이터가 성공적으로 추가되었습니다. 대시보드를 업데이트합니다.');
                updateDashboard();
            };
            reader.readAsArrayBuffer(file);
        } else {
            alert('CSV 또는 엑셀(xlsx) 파일만 업로드할 수 있습니다.');
        }
    });

    const navButtons = document.querySelectorAll('.nav-btn');
    const contentSections = document.querySelectorAll('.content-section');
    navButtons.forEach(button => {
        button.addEventListener('click', () => {
            navButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            const targetId = button.dataset.target;
            contentSections.forEach(section => {
                if (section.id === targetId) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });
        });
    });

    function init() {
        // 초기 데이터 없이 시작
        lectureData = [];
        initializeCharts();
        updateDashboard();
    }

    init();
});
</script>
</body>
</html>
